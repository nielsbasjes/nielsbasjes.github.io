---
layout: post
title: 'Making your own CA work that works with Google Chrome '
date: '2018-02-03T15:04:00.000+01:00'
author: Niels Basjes
tags: 
modified_time: '2018-02-14T20:44:18.433+01:00'
blogger_id: tag:blogger.com,1999:blog-2071414079220000885.post-8015861638960351103
blogger_orig_url: http://blog.basjes.nl/2018/02/making-your-own-ca-work-that-works-with.html
---

<br /><br /><h2>Introduction</h2>This post is about one single aspect of running your own CA (usually for internal systems): Making it actually work with Google Chrome.<br /><br />The reason I writing this down is because I found all the other sources of information around the world very confusing.<br /><br />The main problem is twofold:<br /><ol><li>Newer browsers (like Google Chrome) require that the "Subject Alternative Name" has been defined as part of the certificate.</li><li>When simply signing a certificate request (the includes the "Subject Alternative Name") with openssl this property is lost and the resulting certificate doesn't work.&nbsp;</li></ol><h2><b>Create your own CA.</b></h2><div>On CentOS 7 (which I use right now) the openssl package contains the&nbsp;/etc/pki/tls/misc/CA script that makes doing this very easy.<b><br /></b></div><div><h2><b>Generate key and create a certificate request.</b></h2>Now the confusing part here is that <b>it doesn't matter if the "Subject Alternative Name" is or isn't present in the certificate request.&nbsp;</b>If the "Subject Alternative Name"&nbsp;is present in the certificate request it will be ignored anyway.<br /><br />So you can create the key and certificate request with any existing system and manual.<br /><b><u><br /></u></b>Three basic ways for doing this:<br /><ul><li>Some systems already have one and/or is capable of generating one as part of the solution (like I have seen in VMware ESXi). So this part is done for you.<br /></li><li>Simply using the script provided with openssl for this purpose</li></ul><blockquote class="tr_bq"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">/etc/pki/tls/misc/CA -newreq</span></blockquote></div><div><blockquote class="tr_bq">This will create&nbsp;&nbsp;newkey.pem and&nbsp;newreq.pem</blockquote><ul><li>Manually via a config file.<br />So if you create a config file with something like this:</li></ul><div><div><blockquote class="tr_bq"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[req]<br />default_bits = 2048<br />prompt = no<br />default_md = sha256<br />distinguished_name = dn<br />[ dn ]<br />C=NL<br />ST=Noord Holland<br />L=Amstelveen<br />O=Basjes<br />OU=At home<br />emailAddress=certificates@example.com<br />CN = server.example.com</span></blockquote><blockquote class="tr_bq">then with this config file (let's call it&nbsp;server.example.com.config) you can do&nbsp;</blockquote><blockquote class="tr_bq"><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">openssl req -new -sha256 -nodes \</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-out&nbsp;server.example.com.csr \</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-newkey rsa:2048 \</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-keyout&nbsp;server.example.com.key \</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-config&nbsp;server.example.com.config</span></blockquote></div><h2>Now sign the request and add the desired "Subject Alternative Name" values</h2>To do this we create this config file where we include all the hostnames and IP addresses we want to allow (let's call it&nbsp;server.example.com.sanconfig).<br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[ v3_req ]</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">basicConstraints = CA:FALSE</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">keyUsage = nonRepudiation, digitalSignature, keyEncipherment</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">subjectAltName = @alt_names</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">[ alt_names ]</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">DNS.1 =&nbsp;server.example.com</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">DNS.2 = www.server.example.com</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">IP = 10.11.12.13</span><br /><br /><span style="font-family: inherit;">Now we sign this where we add the config file (-extfile) and instruct to use the extra settings present under v3_req (-extensions). The actual name of the "v3_req" section doesn't really matter.</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">openssl ca -policy policy_anything \</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; &nbsp; &nbsp;-out&nbsp;server.example.com.crt \</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; &nbsp; &nbsp;-in&nbsp;server.example.com.csr \</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; &nbsp; &nbsp;-extfile&nbsp;server.example.com.sanconfig \</span><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">-extensions v3_req</span><br /><br />If during the signing you see something like this then everything went right.<br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">Certificate Details:</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; &nbsp; &nbsp; ...</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; &nbsp; &nbsp; X509v3 extensions:</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; X509v3 Subject Alternative Name:&nbsp;</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DNS:server.example.com, DNS:www.server.example.com, IP Address:10.11.12.13</span><br /><br />As you see the signing command is pretty standard and really only adds the config file with the SAN extension.<br /><h2>Last remark</h2><div>And to actually make your own CA work with chrome you have to import the certificate of your own authority <span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">/etc/pki/CA/cacert.pem</span> file into chrome as a new authority.</div><div><br /></div><br /></div></div>